<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>åœ°çƒOnline v0.5.0</title>

    <style>
        *{ box-sizing:border-box }
        html,body{ height:100% }
        body{
            margin:0; background:#000; color:#fff;
            font-family:"Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
            overflow:hidden;
        }
        #game-root{ position:relative; width:100vw; height:100vh; }

        .login-layer{ position:absolute; inset:0; z-index:10; overflow:hidden; }
        .stars{
            position:absolute; inset:0;
            background: radial-gradient(#fff 1px, transparent 1px);
            background-size: 6px 6px; opacity:.35;
        }

        .earth-wrap {
            position: absolute;
            left: 50%;
            top: 38%;
            transform: translate(-50%, -50%) rotateZ(-23.5deg);
            width: min(320px, 45vw);
            height: min(320px, 45vw);
            filter: drop-shadow(0 30px 80px rgba(0,0,0,0.5));
            perspective: 1000px;
        }

        .earth {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;

            background: url('assets/images/earth-map.jpg') repeat-x;
            background-size: cover;

            animation: earth-spin 20s linear infinite;

            box-shadow:
                    inset 0 0 25px rgba(0,0,0,0.7),
                    0 0 40px rgba(0,150,255,0.8),
                    0 0 80px rgba(0,100,200,0.4);
        }

        @keyframes earth-spin {
            0% {
                background-position: 0 0;
            }
            100% {
                background-position: -100% 0;
            }
        }

        .earth::after {
            /* å…‰å½±æ•ˆæœï¼Œå¢åŠ ç«‹é«”æ„Ÿ */
            content: "";
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3), transparent 40%),
            radial-gradient(circle at 70% 70%, rgba(0,0,0,0.7), transparent 55%);
            pointer-events: none;
        }

        /* ç™»å…¥ UI */
        .login-ui{
            position:absolute; left:50%; top:72%; transform:translate(-50%,-50%);
            width:min(560px,92vw); text-align:center;
            background: rgba(0,0,0,.55);
            border:1px solid rgba(255,255,255,.25);
            border-radius:16px;
            padding:16px 18px;
            backdrop-filter: blur(8px);
        }
        #login-choices{ display:grid; gap:8px; grid-template-columns:1fr 1fr; }
        #login-choices button{
            all:unset; cursor:pointer; text-align:center;
            padding:10px 12px;
            background:rgba(255,255,255,.12);
            border:1px solid rgba(255,255,255,.28);
            border-radius:10px;
            transition:.15s;
        }
        #login-choices button:hover{
            background:rgba(255,255,255,.25);
            transform: translateY(-2px);
        }

        /* ===== éŠæˆ²èƒŒæ™¯ ===== */
        .bg{
            position:absolute; inset:0; z-index:0;
            display:none;
            background-size:cover;
            background-position:center;
        }

        /* ===== è§’è‰²ï¼ˆåªæœ‰æ·¡å…¥ï¼‰ ===== */
        .character{
            position:absolute; bottom:96px;
            width:min(26vw,360px); height:min(70vh,640px);
            display:none; align-items:flex-end;
            opacity:0; z-index:3;
        }
        .character.active{
            display:flex;
            animation: fadeIn 0.6s ease forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .side-left{ left:2% }
        .side-right{ right:2% }
        .character .avatar{
            width:100%; height:100%;
            background-size:contain;
            background-repeat:no-repeat;
            background-position: bottom center;
            background-color: rgba(255,255,255,0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }
        .character .name{
            position:absolute; bottom:0; left:10px;
            background:rgba(0,0,0,.55);
            border:1px solid rgba(255,255,255,.25);
            padding:4px 8px;
            border-radius:8px;
            font-size:14px;
        }

        /* ===== å°è©±æ¡† ===== */
        .dialog{
            position:absolute; left:50%; transform:translateX(-50%);
            bottom:20px;
            width:min(900px,76vw);
            background:rgba(0,0,0,.6);
            border:1px solid rgba(255,255,255,.22);
            border-radius:14px;
            padding:12px 16px;
            z-index:4;
            display:none;
        }
        .scene-title{ font-weight:800; color:#ffd166; margin-bottom:6px }
        .dialog-text{ font-size:16px; line-height:1.6; min-height:44px; }

        /* ===== é¸é … ===== */
        .choices{
            position:absolute; left:50%; transform:translateX(-50%);
            bottom:130px;
            display:none;
            flex-direction:column;
            gap:18px;
            z-index:5;
            align-items:center;
        }
        .choice-btn {
            all: unset;
            cursor: pointer;
            width: min(420px, 90vw);
            text-align: center;

            /* æ·±è‰²èƒŒæ™¯ */
            background: rgba(20, 20, 20, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.4);

            padding: 12px 16px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            color: #fff;
            transition: 0.2s;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.6);
        }

        .choice-btn:hover {
            transform: translateY(-2px);
            background: rgba(40, 40, 40, 0.95);
            border-color: rgba(255, 255, 255, 0.6);
        }

        /* ===== å°éŠæˆ²å¡ç‰‡ ===== */
        .mini-game{ position:absolute; inset:0; z-index:6; display:grid; place-items:center; }
        .mini-card{
            width:min(680px,92vw);
            background:rgba(0,0,0,.72);
            border:1px solid rgba(255,255,255,.22);
            border-radius:14px;
            padding:16px;
            backdrop-filter: blur(6px);
        }
        .mini-title{ font-size:20px; font-weight:800; margin-bottom:8px }
        .mini-question{ font-size:22px; margin:8px 0 14px }
        .mini-options{ display:grid; gap:10px }
        .mini-btn{
            all:unset; cursor:pointer; text-align:left;
            background:rgba(255,255,255,.14);
            border:1px solid rgba(255,255,255,.32);
            padding:10px 12px;
            border-radius:10px;
            transition:.15s;
        }
        .mini-btn:hover{ background:rgba(255,255,255,.28) }
        .mini-progress{ margin-top:10px; opacity:.85; font-size:14px }
    </style>
</head>
<body>
<div id="game-root">
    <!-- ç™»å…¥å±¤ -->
    <div class="login-layer" id="login-layer">
        <div class="stars"></div>
        <div class="earth-wrap">
            <div class="earth"></div>
        </div>
        <div class="login-ui" id="login-ui">
            <h1>ğŸŒ åœ°çƒ Online</h1>
            <p>äºæ´²é»‘è‰²å¹½é»˜å¢å¼·ç‰ˆ v0.0.2</p>
            <div id="login-choices"></div>
        </div>
    </div>

    <!-- èƒŒæ™¯ -->
    <div id="bg" class="bg"></div>

    <!-- è§’è‰² -->
    <div id="char-left" class="character side-left">
        <div class="avatar"></div>
        <div class="name"></div>
    </div>
    <div id="char-right" class="character side-right">
        <div class="avatar"></div>
        <div class="name"></div>
    </div>

    <!-- å°è©±æ¡† -->
    <div id="dialog" class="dialog">
        <div id="scene-title" class="scene-title"></div>
        <div id="dialog-text" class="dialog-text"></div>
    </div>

    <!-- é¸é … -->
    <div id="choices" class="choices"></div>
</div>
<audio id="bgm-player" preload="auto" loop></audio>

<script>
    // Assets (using placeholders since files may not exist)
    const assets = {
        bg: {
            morning:  "assets/backgrounds/morning.jpg",
            train:    "assets/backgrounds/train.jpg",
            exam:     "assets/backgrounds/exam.jpg",
            lunch:    "assets/backgrounds/lunch.jpg",
            english:  "assets/backgrounds/english.jpg",
            home:     "assets/backgrounds/home.jpg",
            dinner:   "assets/backgrounds/dinner.jpg",
            final:    "assets/backgrounds/final.jpg",
            death:    "assets/backgrounds/death.jpg",
            ending:   "assets/backgrounds/ending.jpg",
        },
        chars: {
            player:  "assets/characters/player.png",
            mom:     "assets/characters/mom.png",
            dad:     "assets/characters/dad.png",
            teacher: "assets/characters/teacher.png",
        },
    };

    // Game scenes
    const scenes = {
        login: {
            title: "ç™»å…¥ä¼ºæœå™¨",
            text: "æ­¡è¿ä¾†åˆ°ã€Šåœ°çƒOnlineã€‹v0.0.2 äºæ´²é»‘è‰²å¹½é»˜å¢å¼·ç‰ˆ\nè«‹é¸æ“‡ä¼ºæœå™¨ï¼š",
            bg: null,
            left: null,
            right: null,
            choices: [
                { text: "äºæ´²ï¼ˆç†±é–€ï¼Œå…§å·ä¿®ç¾…å ´ï¼‰", next: "role" },
                { text: "ç¾æ´²ï¼ˆé ˆæ’éšŠ800å°æ™‚ï¼Œç¾å¼å¿«æ¨‚æ•™è‚²æ¸¬è©¦æœï¼‰", death: "ã€å¤±æ•—ã€‘ä¼ºæœå™¨æ’éšŠä¸­ï¼Œäººç”Ÿå·²éå®Œä¸€è¼ªã€‚" },
                { text: "æ­æ´²ï¼ˆå·²çˆ†æ»¿ï¼Œç³»çµ±æ›æ©Ÿé¤Šè€æ¨¡å¼ï¼‰", death: "ã€å¤±æ•—ã€‘ä¼ºæœå™¨æ»¿å“¡ï¼Œè«‹è½‰ç”Ÿè‡³äºæ´²ä¼ºæœå™¨ã€‚" },
                { text: "éæ´²ï¼ˆå°šæœªé–‹æ”¾ï¼Œè³‡æºä¸è¶³ä¼ºæœå™¨ï¼‰", death: "ã€å¤±æ•—ã€‘ä¼ºæœå™¨ä¸å­˜åœ¨ï¼Œå¤¢æƒ³ä¹Ÿä¸å­˜åœ¨ã€‚" },
            ]
        },
        role: {
            title: "è§’è‰²å‰µå»º",
            text: "é¸æ“‡è§’è‰²ï¼š",
            bg: null,
            left: null, right: null,
            choices: [
                { text: "ç”·æ€§ï¼ˆè‡ªå¸¶ã€Œæ‰“å·¥äººã€å¤©è³¦ï¼‰", next: "intro" },
                { text: "å¥³æ€§ï¼ˆ80% è¢«ä¸Ÿé€²æ²³è£¡ï¼Œ20% å®¢æœï¼‰", death: "ã€å¤±æ•—ã€‘ä½ é‚„æ²’å‡ºç”Ÿå°±è¢«é€å»å®¢æœä¸Šç­ã€‚" },
                { text: "è³¼ç‰©è¢‹ï¼ˆæ¸¬è©¦ä¸­ï¼Œå­˜æ´»ç‡æœªçŸ¥ï¼‰", death: "ã€å¤±æ•—ã€‘ä¸€é™£é¢¨èµ·ï¼Œä½ è¢«å¹èµ°äº†ã€‚" },
            ]
        },
        intro: {
            title: "ä¸»è§’è³‡è¨Š",
            text: "åç¨±ï¼šéƒ­ç›Šé–\næ€§åˆ¥ï¼šç”·\nç­‰ç´šï¼š15\nä¸»ç·šä»»å‹™ï¼šè®“çˆ¶æ¯é–‹å¿ƒï¼Œä¸¦è¨­æ³•æ´»ä¸‹ä¾†ï¼ˆäºæ´²æœé™å®šæŒ‘æˆ°æ¨¡å¼ï¼‰",
            bg: "morning",
            left: "player",
            right: null,
            choices: [{text: "é–‹å§‹éŠæˆ²", next: "morning1"}]
        },
        /* ======= æ—©æ™¨ä¸‰æ®µ ======= */
        morning1: {
            title: "æ—©æ™¨èµ·åºŠ",
            bgm: "super_idol.mp3",
            text: "ğŸµ ä½ è¢«ã€ŠSuper Idolã€‹çš„éŸ³æ¨‚åµé†’ï¼Œçœ¼ç›é‚„æ²’çœé–‹å°±æ„Ÿè¦ºåˆ°æ¯è¦ªçš„æ®ºæ°£ã€‚",
            bg: "morning", left: "mom", right: "player",
            choices: [
                { text: "A. é†’ä¾†é—œé¬§é˜", next: "morning2" },
                { text: "B. ç¹¼çºŒç¡", death: "ä½ éŒ¯éæ®µè€ƒï¼Œè¢«æ¯è¦ªã€Œé–ƒé›»è¡£æ¶åŠˆã€+ çˆ¶è¦ªã€Œçš®å¸¶å¤§æ³•å¥½ã€è™•æ±ºã€‚\nğŸª¦ã€åˆ¥äººèµ·åºŠæ‹¼æœªä¾†ï¼Œä½ èµ·åºŠæ‹¼å–ªç¦®ã€‘" }
            ]
        },

        morning2: {
            title: "åˆ·ç‰™æ™‚é–“",
            text: "æµ´å®¤è£¡çš„ç‰™åˆ·éœéœåœ°ç«‹è‘—ï¼Œä½ è…¦æµ·ä¸­æµ®ç¾ä¸€å¥å¤è€çš„äºæ´²æ ¼è¨€ï¼šã€Œä¸åˆ·ç‰™ï¼Œæ­»æ›´å¿«ã€ã€‚",
            bg: "morning", left: null, right: "player",
            choices: [
                { text: "A. èªå‘½åˆ·ç‰™", next: "morning3" },
                { text: "B. å·ç©æ‰‹æ©Ÿ", death: "æ»‘å€’æ’ç ´é ­ï¼Œæ‰‹æ©Ÿæˆæœ€å¾Œé™ªè‘¬å“ã€‚\nğŸª¦ã€ç§‘æŠ€æ˜¯é€²æ­¥ï¼Œä¹Ÿæ˜¯çµ†è…³çŸ³ã€‘" }
            ]
        },

        morning3: {
            title: "æ—©é¤æ™‚é–“",
            text: "åª½åª½ï¼šã€Œç›Šé–ï¼Œå¿«åƒæ—©é¤ï¼Œä¸åƒæœƒæ­»ï¼ã€",
            bg: "morning", left: "mom", right: "player",
            choices: [
                { text: "A. åè‘—åƒæ—©é¤", next: "train1" },
                { text: "B. é‚Šèµ°é‚Šåƒ", death: "è¢«è²¨è»Šç•¶æ—©é¤è£œéµã€‚\nğŸª¦ã€åˆ¥äººè£œå……ç‡Ÿé¤Šï¼Œä½ è£œå……éµå¡Šã€‘" }
            ]
        },

        train1:{
            title: "ä¸Šè»Šæ‰¾ä½å­",
            text: "ç«è»Šç·©ç·©é§›é€²æœˆå°ï¼Œä½ æ“ é€²è»Šå»‚æ™‚çœ‹åˆ°ä¸€å€‹ç©ºä½ã€‚",
            bg: "train", left: null, right: "player",
            choices: [
                { text: "A. ä¹–ä¹–ç«™è‘—çœ‹æ›¸", next: "train2" },
                { text: "B. æ¶åšæ„›åº§", death: "è¢«é˜¿å§¨è¯åˆæ”»æ“Šï¼Œæ‰”ä¸‹è»Šå¤–ã€‚\nğŸª¦ã€è€å¤©éµå•Šï¼Œåšæ„›åšæ„›æˆæ‚²å“€ã€‘" }
            ]
        },

        train2: {
            title: "å°å·äº‹ä»¶",
            text: "çªç„¶æœ‰äººå¤§å–Šï¼šã€Œæˆ‘çš„éŒ¢åŒ…ä¸è¦‹äº†ï¼ã€\nå…¨è»Šç›®å…‰é½Šåˆ·åˆ·ç›¯å‘ä½ ã€‚",
            bg: "train", left: null, right: "player",
            choices: [
                { text: "A. å¹«å¿™æŠ“å°å·", next: "train3" },
                { text: "B. ä»€éº¼éƒ½ä¸åš", death: "ä½ è¢«èª¤èªç‚ºå°å·ï¼Œç›´æ¥è¢«ç¾¤æ¯†è‡´æ­»ã€‚\nğŸª¦ã€æ²‰é»˜ä¸ä»£è¡¨ç„¡è¾œã€‘" }
            ]
        },

        train3: {
            title: "é¸æ“‡å°ˆæ³¨",
            text: "å°å·äº‹ä»¶è½å¹•ï¼Œç«è»Šç¹¼çºŒå‰é€²ï¼Œä½ æ±ºå®šï¼š",
            bg: "train", left: null, right: "player",
            choices: [
                { text: "A. è¤‡ç¿’æ•¸å­¸ï¼Œæº–å‚™è¿æ¥ä»Šå¤©çš„è€ƒè©¦", next: "exam1" },
                { text: "B. ç©æ‰‹éŠ", death: "ç¡åˆ°é«˜é›„ï¼Œä¸‹è»Šç™¼ç¾æ®µè€ƒçµæŸï¼Œåª½è¦‹æ‰“ã€‚\nğŸª¦ã€é«˜é›„æ­¡è¿ä½ ï¼Œä½†ä½ å·²ç„¡äººç”Ÿã€‘" }
            ]
        },

        exam1: {
            title: "æ•¸å­¸è€ƒè©¦é–‹å§‹",
            text: "è€ƒå·ä¸€ç¿»é–‹ï¼Œå…¨æ˜¯ sinã€cosã€tan ä¹‹é¡çš„æ±è¥¿ï¼Œä½ ç™¼ç¾è‡ªå·±è¤‡ç¿’éŒ¯ç¯„åœã€‚",
            bg: "exam", left: "teacher", right: "player",
            choices: [
                { text: "A. æ·±å‘¼å¸å†·éœä¸‹ä¾†", next: "exam2" },
                { text: "B. æ”¾è²å¤§å“­", death: "ç›£è€ƒè€å¸«èªç‚ºä½ ä½œå¼Šï¼Œç”¨åœ“è¦åˆºæ­»ä½ ã€‚\nğŸª¦ã€çœ¼æ·šæ›ä¸ä¾†åˆ†æ•¸ã€‘" }
            ]
        },

        exam2:{
            title: "æ±ºå®šç­–ç•¥",
            text: "ä½ ç’°é¡§å››å‘¨ï¼ŒåŒå­¸å€‘åƒä¸€ç¾¤æ©Ÿå™¨äººï¼Œç˜‹ç‹‚æ›¸å¯«ã€‚\nä½ åªèƒ½ï¼š",
            bg: "exam", left: "teacher", right: "player",
            choices: [
                { text: "A. ç¥ˆç¦±ç¥è¹Ÿ", death: "ä½›ç¥–ä¿ä½‘ä¹Ÿæ•‘ä¸äº†ï¼Œå›å®¶é‹å­ä¼ºå€™ã€‚\nğŸª¦ã€ç¥ä¸æ•‘äºæ´²å­©å­ã€‘" },
                { text: "B. å°‹æ‰¾æœƒåšçš„é¡Œç›®", next: "MathGame" },
                { text: "C. ç›´æ¥ç¡è¦º", death: "0 åˆ†ï¼Œè€çˆ¹æ–½å±•ã€Œè¸¹ä½ æ­»åŠŸå¤«ã€ã€‚\nğŸª¦ã€ç¡çœ æ˜¯è‡ªç”±ï¼Œä»£åƒ¹æ˜¯ç”Ÿå‘½ã€‘" }
            ]
        },




        lunch1:{
            title: "åˆé¤æ™‚æ®µ",
            text: "ä¸‹èª²é˜éŸ¿èµ·ï¼Œå…¨ç­äººè¡å‘é¤å»³æ¶ä½å­ï¼Œä½ é¢è‡¨é¸æ“‡ï¼š",
            bg: "lunch", left: null, right: "player",
            choices: [
                { text: "A. è·ŸåŒå­¸è¡ç¬¬ä¸€æ³¢", next: "lunch2" },
                { text: "B. æ…¢æ…¢èµ°ï¼Œä¿æŒå„ªé›…", death: "ä½ è¢«å¾Œæ’æš´è¡çš„äººç¾¤è¸©æˆè‚‰é¤…ã€‚\nğŸª¦ã€å„ªé›…æ˜¯æ…¢æ€§è‡ªæ®ºã€‘" }
            ]
        },

        lunch2:{
            title: "é¤å»³ä¿®ç¾…å ´",
            text: "çµ‚æ–¼æ‹¿åˆ°é¤ç›¤ï¼Œå‰æ–¹å‡ºç¾ä¸‰å€‹æ”¤ä½ï¼šç‚¸é›æ’ã€é’èœã€ç¥ç§˜æ–™ç†ã€‚",
            bg: "lunch", left: null, right: "player",
            choices: [
                { text: "A. é¸ç‚¸é›æ’", next: "lunch3" },
                { text: "B. é¸é’èœ", death: "è¢«å˜²ç¬‘å¤ªå¥åº·ï¼Œè¢«é›†é«”éœ¸å‡Œè‡´æ­»ã€‚\nğŸª¦ã€ç¶ è‰²è”¬èœï¼Œç´…è‰²è¡€è·¡ã€‘" },
                { text: "C. é¸ç¥ç§˜æ–™ç†", death: "åƒä¸‹å»ç²å¾— +99 è…¹ç€‰ DEBUFFï¼Œå»æ‰€çŒæ­»ã€‚\nğŸª¦ã€æ¢éšªæ˜¯å‹‡æ°£ï¼Œä¹Ÿæ˜¯æ®å‘½ã€‘" }
            ]
        },

        lunch3:{
            title: "åˆé¤å¾Œ",
            text: "åƒé£½å¾Œï¼Œä½ çŒ¶è±«ä¸‹ä¸€æ­¥è©²åšä»€éº¼ã€‚",
            bg: "lunch", left: null, right: "player",
            choices: [
                { text: "A. ä¼‘æ¯æ»‘æ‰‹æ©Ÿ", death: "äºæ´²ç¤¾æœƒä¸å…è¨±ä½ å–˜æ¯ã€‚\nğŸª¦ã€ä¼‘æ¯ç­‰æ–¼æ­»äº¡ã€‘" },
                { text: "B. èƒŒè‹±æ–‡å–®å­—", next: "englishExam1" }
            ]
        },


        englishExam1:{
            title: "è‹±æ–‡è€ƒè©¦å‰å¤•",
            text: "è€å¸«èµ°é€²æ•™å®¤ï¼Œæ‰‹è£¡æ‹¿è‘—ä¸€ç–Šåšåšçš„è€ƒå·ï¼Œè¡¨æƒ…åƒåœ¨å®£å¸ƒæ­»åˆ‘ã€‚",
            bg: "english", left: "teacher", right: "player",
            choices: [
                { text: "A. æ·±å‘¼å¸å†·éœä¸‹ä¾†", next: "englishExam2" },
                { text: "B. è·Ÿéš”å£åŒå­¸èŠå¤©", death: "è¢«è€å¸«ç•¶å ´æŠ“åŒ…ï¼Œæ‰£ 100 åˆ†ã€‚\nğŸª¦ã€ç¤¾äº¤æ˜¯å¢³å ´ã€‘" }
            ]
        },

        englishExam2:{
            title: "ç¬¬ä¸€é¡Œ",
            text: "è€ƒå·ç¬¬ä¸€é¡Œæ˜¯ä¸€å€‹è¶…ç°¡å–®çš„è‹±æ–‡å¡«ç©ºï¼Œ\nå¦‚æœéŒ¯äº†å°‡é­åˆ°è€å¸«æ­»äº¡å‡è¦–ã€‚",
            bg: "english", left: "teacher", right: "player",
            choices: [
                { text: "A. èªçœŸä½œç­”", next: "englishExam3" },
                { text: "B. éš¨ä¾¿äº‚å¯«", death: "è€å¸«ç›´æ¥æ‹¿ç²‰ç­†æ’é€²ä½ æ°£ç®¡ã€‚\nğŸª¦ã€äº‚å¯«é€Ÿæ­»ã€‘" }
            ]
        },

        englishExam3:{
            title: "è€ƒå·çµ‚ç« ",
            text: "è€å¸«ï¼šã€Œæ¥ä¸‹ä¾†æ˜¯å°éŠæˆ²ç’°ç¯€ï¼ŒéŒ¯ä¸€é¡Œå°± Game Overã€‚ã€",
            bg: "english", left: "teacher", right: "player",
            choices: [
                { text: "é–‹å§‹è‹±æ–‡å°éŠæˆ²", next: "englishGame" }
            ]
        },


        home1:{
            title: "å›åˆ°å®¶",
            text: "ä½ ä¸€è¸é€²å®¶é–€ï¼Œå°±çœ‹åˆ°åª½åª½åœ¨å»šæˆ¿æ‹¿èœåˆ€ã€‚",
            bg: "home", left: "mom", right: "player",
            choices: [
                { text: "A. å‡è£æ²’çœ‹è¦‹ï¼Œèµ°å›æˆ¿é–“", next: "home2" },
                { text: "B. èª¿ä¾ƒå¥¹ï¼šã€ŒOkaasanï¼Œcosplay å¥½åƒå“¦ï¼ã€", death: "åˆ€ç›´æ¥é£›å‘ä½ ã€‚\nğŸª¦ã€ç©ç¬‘ä¹Ÿæ˜¯æ­»äº¡é™·é˜±ã€‘" }
            ]
        },

        home2:{
            title: "çˆ¶æ¯è³ªå•",
            text: "åª½åª½ï¼šã€Œä½ ä»Šå¤©è€ƒå¾—æ€æ¨£ï¼Ÿã€\nä½ ï¼šâ€¦â€¦",
            bg: "home", left: "mom", right: "dad",
            choices: [
                { text: "A. èª å¯¦èªªè€ƒä¸å¥½", death: "çˆ¸åª½åŒæ™‚å¤§çˆ†ç‚¸ï¼Œå®¶åº­æ ¸å¹³ã€‚\nğŸª¦ã€çœŸç›¸æ˜¯å¼•çˆ†å™¨ã€‘" },
                { text: "B. æ’’è¬Šèªªè€ƒå¾ˆå¥½", next: "home3" }
            ]
        },

        home3:{
            title: "é—œéµé¸æ“‡",
            text: "çˆ¸çˆ¸ç›¯è‘—ä½ ï¼Œçœ¼ç¥åƒè¦æŠŠä½ çœ‹ç©¿ã€‚",
            bg: "home", left: "dad", right: "player",
            choices: [
                { text: "A. è£æ™´å¤©å¨ƒå¨ƒ â†’ éš±è—é€šé—œ", next: "hiddenEnding" },
                { text: "B. ä½é ­æ²‰é»˜", next: "dinner1" },
                { text: "C. åæ“Šé ‚å˜´", death: "å…¨å®¶çˆ†æ‰“ä½ ä¸€é “ï¼Œé€æ€¥è¨ºæœªé†’ä¾†ã€‚\nğŸª¦ã€è‡ªç”±çš„ä»£åƒ¹æ˜¯å…¨æ»…ã€‘" }
            ]
        },


        dinner1:{
            title: "æ™šé¤é–‹å±€",
            text: "åª½åª½ï¼šã€Œç›Šé–ï¼Œåƒé£¯äº†ï¼ã€\næ¡Œä¸Šæ“ºè‘—æ»¿æ»¿èœé¤šã€‚",
            bg: "dinner", left: "mom", right: "dad",
            choices: [
                { text: "A. åªåƒç™½é£¯", next: "dinner2" },
                { text: "B. å®Œå…¨ä¸ç†å¥¹", death: "åª½åª½ç›´æ¥æ‘”é‹ç ¸é ­ã€‚\nğŸª¦ã€ä¸åƒå³æ­»ï¼Œåƒäº†æ›´æ­»ã€‘" }
            ]
        },

        dinner2:{
            title: "åª½åª½å˜†æ°£",
            text: "åª½åª½å˜†æ°£ï¼šã€Œæˆ‘ç…®é€™éº¼å¤šï¼Œä½ ä¸æƒ³åƒå°±ç›´èªªå˜›ï¼ã€",
            bg: "dinner", left: "mom", right: "player",
            choices: [
                { text: "A. èªæ…«ï¼Œä¹–ä¹–åƒèœ", next: "dinner3" },
                { text: "B. å˜´è‡­å›æ‡Ÿ", death: "çˆ¸åª½åˆåŠ›é–‹å¤§ã€‚\nğŸª¦ã€å˜´è‡­æ›ä¾†å®¶åº­é€£åã€‘" }
            ]
        },

        dinner3:{
            title: "æ™šé¤çµæŸ",
            text: "é£¯å¾Œï¼Œä½ è¦ºå¾—æ°£æ°›æœ‰äº›å¾®å¦™ï¼Œè©²åšä»€éº¼å‘¢ï¼Ÿ",
            bg: "dinner", left: "player", right: null,
            choices: [
                { text: "A. å¹«å¿™æ”¶æ¡Œå­", next: "finalEvent1" },
                { text: "B. å·å·æºœå›æˆ¿é–“", death: "è¢«çˆ¸åª½æ””ä¸‹ç•¶å ´æ–¬ç«‹æ±ºã€‚\nğŸª¦ã€é€ƒä¸å‡ºæ™šé¤ï¼Œä¹Ÿé€ƒä¸å‡ºåŸç”Ÿå®¶åº­ã€‘" }
            ]
        },


        dinner2: {
            title: "åª½åª½å˜†æ°£",
            text: "åª½åª½å˜†æ°£ï¼šã€Œæˆ‘ç…®é€™éº¼å¤šï¼Œä½ ä¸æƒ³åƒå°±ç›´èªªå˜›ï¼ã€",
            bg: "dinner", left: "mom", right: "player",
            choices: [
                { text: "A. ã€Œä½ ç…®çš„åƒè»Šè«¾æ¯”è¼»å°„ä¸‰åå¹´è¢å…‰æ–™ç†ã€‚ã€", death: "åª½è¦‹æ‰“ + çˆ¸åƒæˆ°ã€‚\nğŸª¦ã€å˜´è‡­æ›ä¾†å®¶åº­é€£åã€‘" },
                { text: "B. ã€Œæˆ‘å€‘ç”Ÿæ´»ï¼Œæˆ‘å€‘æ„›ï¼Œæˆ‘å€‘èªªè¬Šï¼Œåœ¨äºç‰¹è˜­ææ–¯â€¦ã€", death: "è¢«èªå®šå˜‰è±ªç—‡å€™ç¾¤ï¼Œé€èµ°ç«åŒ–ã€‚\nğŸª¦ã€ä¸­äºŒæ˜¯ç—…ï¼Œç¤¾æœƒä¾†é†«ã€‘" },
                { text: "C. èªæ…«ï¼Œä¹–ä¹–åƒèœã€‚", next: "finalEvent1" }
            ]
        },

        finalEvent1:{
            title: "é£¯å¾Œé¸æ“‡ 1",
            text: "ä»Šæ™šçš„å¤œè‰²è®“ä½ æ„Ÿåˆ°ä¸å®‰ã€‚",
            bg: "final", left: "player", right: null,
            choices: [
                { text: "A. å‡ºå»æ•£æ­¥", next: "finalEvent2" },
                { text: "B. ç›´æ¥ç¡è¦º", next: "ending" }
            ]
        },

        finalEvent2:{
            title: "æ•£æ­¥é€”ä¸­",
            text: "èµ°åœ¨å··å­è£¡ï¼Œä¸€å°è²¨è»Šçªç„¶å‡ºç¾ï¼",
            bg: "final", left: null, right: "player",
            choices: [
                { text: "A. é–ƒé¿è²¨è»Š", next: "finalEvent3" },
                { text: "B. å‘†ç«™åŸåœ°", death: "è¢«è²¨è»Šä¾†å›è¼¾å£“ã€‚\nğŸª¦ã€é£²æ–™æ¼²åƒ¹åªæ˜¯åºæ›²ï¼Œè²¨è»Šæ‰æ˜¯ä¸»æ—‹å¾‹ã€‘" }
            ]
        },

        finalEvent3:{
            title: "çµ‚æ¥µé¸æ“‡",
            text: "ä½ å®‰ç„¶èµ°åˆ°ä¾¿åˆ©å•†åº—å‰ï¼Œæƒ³èµ·ä»Šæ™šçš„ç…©æƒ±ï¼š",
            bg: "final", left: "player", right: null,
            choices: [
                { text: "A. è²·é£²æ–™", death: "ä¸€è½‰èº«è¢«å°æ··æ··åˆºæ­»ã€‚\nğŸª¦ã€ç”œèœœçš„é£²æ–™ï¼Œè¡€è…¥çš„ä»£åƒ¹ã€‘" },
                { text: "B. å›æˆ¿è®€æ›¸", death: "ç†¬å¤œçŒæ­»ã€‚\nğŸª¦ã€çŸ¥è­˜æ”¹è®Šå‘½é‹ï¼Œä½†å…ˆæ”¹è®Šä½ çš„å£½å‘½ã€‘" },
                { text: "C. ä¾†å ´çŒœæ‹³å°éŠæˆ²", next: "rpsGame" },
                { text: "D. å›å®¶å®‰ç„¶ç¡è¦º", next: "ending" }
            ]
        },


        hiddenEnding: {
            title: "éš±è—é€šé—œ",
            text: "âœ¨ æˆåŠŸè£æˆæ™´å¤©å¨ƒå¨ƒ = é€šé—œï¼Œä½†åªæ˜¯é€²å…¥ã€Œæ–°æ‰‹æ‘åœ°ç„å‰¯æœ¬ã€ã€‚",
            bg: "ending", left: null, right: null,
            choices: [ { text: "é‡æ–°æŠ•èƒï¼ˆå›ç™»å…¥ï¼‰", next: "login" } ]
        },

        ending: {
            title: "éŠæˆ²çµç®—",
            text: () => `ğŸ“Š å­˜æ´»æ™‚é–“ï¼š18 å°æ™‚ 32 åˆ†é˜\næ­»äº¡æ¬¡æ•¸ï¼š${state.deaths}\nBuffï¼šå…§å· MAXã€æ¯”è¼ƒå¿ƒæ…‹ +999ã€äºæ´²å¼é™°å½± æ°¸ä¹…ç¶å®š\n\nâš ï¸ ã€Šåœ°çƒOnlineã€‹äºæ´²ä¼ºæœå™¨ç‚ºæ°¸ä¹… Hard æ¨¡å¼ï¼Œç„¡æ³•èª¿æ•´é›£åº¦ã€‚\nDLCï¼šè£œç¿’ç­ç…‰ç„ç¯‡ï¼ˆå¿…è²·ï¼‰ï¼ç›¸è¦ªå®‰æ’ç¯‡ï¼ˆä¸­åœ‹æœï¼‰ï¼é¤Šè€é†«é™¢æ’éšŠç¯‡ï¼ˆæ­æ´²æ¸¬è©¦ä¸­ï¼‰`,
            bg: "ending", left: null, right: null,
            choices: [ { text: "é‡æ–°æŠ•èƒï¼ˆå›ç™»å…¥ï¼‰", next: "login", action: () => { state.deaths = 0; } } ]
        },

        death: {
            title: "ä½ æ­»äº†",
            text: "â€¦â€¦",
            bg: "death", left: null, right: null,
            choices: [ { text: "å›åˆ°ç™»å…¥ç•«é¢", next: "login", action: () => { state.deaths = 0; } } ]
        }
    };

    /* éŠæˆ²ç‹€æ…‹ */
    let state = {
        scene: "login",
        deaths: 0
    };

    /* ===== å·¥å…·å‡½æ•¸ ===== */
    function rand(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function shuffle(arr) {
        return arr.sort(() => Math.random() - 0.5);
    }

    /* æ‰“å­—æ©Ÿæ•ˆæœ */
    let typerTimer = null;
    function typeWriter(el, text, speed = 34) {
        if (typerTimer) clearInterval(typerTimer);
        el.textContent = "";
        let i = 0;
        typerTimer = setInterval(() => {
            el.textContent += text.charAt(i++);
            if (i >= text.length) clearInterval(typerTimer);
        }, speed);
    }

    /* é‡ç½®ç•«é¢ï¼Œé¿å…é‡ç–Š */
    function resetUI() {
        document.getElementById("choices").innerHTML = "";
        document.getElementById("choices").style.display = "none";
        document.getElementById("dialog-text").textContent = "";
        ["char-left", "char-right"].forEach(id => {
            const c = document.getElementById(id);
            c.classList.remove("active");
            c.style.display = "none";
        });
        // ç§»é™¤å°éŠæˆ²å±¤
        document.querySelectorAll(".mini-game").forEach(el => el.remove());
    }

    /* ===== åˆå§‹åŒ–ç™»å…¥é¸å–® ===== */
    (function initLoginButtons() {
        const box = document.getElementById("login-choices");
        box.innerHTML = "";
        scenes.login.choices.forEach(choice => {
            const btn = document.createElement("button");
            btn.textContent = choice.text;
            btn.onclick = () => handleChoice(choice);
            box.appendChild(btn);
        });
    })();

    /* ===== èƒŒæ™¯ç®¡ç† ===== */
    function setBackground(key) {
        const el = document.getElementById("bg");
        if (!key) {
            el.style.backgroundImage = "none";
            return;
        }
        const url = assets.bg[key];
        if (!url) {
            el.style.backgroundImage = "none";
            return;
        }
        // è‹¥åœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨æ¼¸å±¤èƒŒæ™¯é¿å…ç©ºç™½
        const img = new Image();
        img.onload = () => (el.style.backgroundImage = `url('${url}')`);
        img.onerror = () => (el.style.backgroundImage = "radial-gradient(1000px 800px at 50% 120%, #202020, #000)");
        img.src = url;
    }

    /* ===== è§’è‰²é¡¯ç¤ºï¼ˆæ·¡å…¥ï¼‰ ===== */
    function renderChar(id, who) {
        const wrap = document.getElementById(id);
        if (!who) {
            wrap.style.display = "none";
            wrap.classList.remove("active");
            return;
        }
        const emoji = assets.chars[who];
        const avatar = wrap.querySelector(".avatar");
        const name = wrap.querySelector(".name");

        const nameMap = {
            player: "éƒ­ç›Šé–",
            mom: "åª½åª½",
            dad: "çˆ¸çˆ¸",
            teacher: "è€å¸«"
        };

        name.textContent = nameMap[who] || who;
        if (emoji) {
            avatar.style.backgroundImage = `url('${emoji}')`;
            avatar.textContent = "";
        } else {
            avatar.style.backgroundImage = "none";
            avatar.textContent = "ğŸ‘¤";
        }

        wrap.style.display = "flex";
        wrap.classList.remove("active");
        void wrap.offsetWidth; // å¼·åˆ¶é‡ç¹ªï¼Œç¢ºä¿å‹•ç•«è§¸ç™¼
        wrap.classList.add("active");
    }

    /* ===== è™•ç†é¸é … ===== */
    function handleChoice(choice) {
        // æ­»äº¡åˆ†æ”¯
        if (choice.death) {
            state.deaths++;
            scenes.death.text = choice.death;
            state.scene = "death";
            resetUI();
            renderScene();
            return;
        }

        // ç‰¹æ®Šå‹•ä½œ
        if (choice.action) choice.action();

        // é€²å…¥æ•¸å­¸å°éŠæˆ²
        if (choice.next === "MathGame") {
            resetUI();
            startMathGame();
            return;
        }
        // é€²å…¥è‹±æ–‡å°éŠæˆ²
        if (choice.next === "englishGame") {
            resetUI();
            startEnglishGame();
            return;
        }
        // é€²å…¥çŒœæ‹³å°éŠæˆ²
        if (choice.next === "rpsGame") {
            resetUI();
            startRpsGame();
            return;
        }

        // åˆ‡æ›å ´æ™¯
        if (choice.next) {
            state.scene = choice.next;
            resetUI();
            renderScene();
        }
    }

    /* ===== æ¸²æŸ“å ´æ™¯ ===== */
    function renderScene() {
        const s = scenes[state.scene];

        // ç™»å…¥ç•«é¢é¡¯ç¤º
        if (state.scene === "login") {
            document.getElementById("login-layer").style.display = "block";
            document.getElementById("bg").style.display = "none";
            document.getElementById("dialog").style.display = "none";
            return;
        } else {
            document.getElementById("login-layer").style.display = "none";
            document.getElementById("bg").style.display = "block";
            document.getElementById("dialog").style.display = "block";
        }

        // è¨­å®šèƒŒæ™¯èˆ‡è§’è‰²
        setBackground(s.bg);
        renderChar("char-left", s.left);
        renderChar("char-right", s.right);

        // å ´æ™¯æ¨™é¡Œèˆ‡æ–‡å­—
        document.getElementById("scene-title").textContent = s.title || "";
        const textEl = document.getElementById("dialog-text");
        const fullText = typeof s.text === "function" ? s.text() : (s.text || "");
        typeWriter(textEl, fullText, 30);

        // é¸é …
        const box = document.getElementById("choices");
        box.innerHTML = "";
        s.choices.forEach(c => {
            const b = document.createElement("button");
            b.className = "choice-btn";
            b.textContent = c.text;
            b.onclick = () => handleChoice(c);
            box.appendChild(b);
        });
        box.style.display = "flex";
    }

    /* ========== å°éŠæˆ²ï¼šå¯¦æ•¸èˆ‡ç°¡å–®ä»£æ•¸æ··åˆé¡Œ ========== */

    /* å•Ÿå‹•æ•¸å­¸éŠæˆ² */
    /* ========== å°éŠæˆ²ï¼šå¯¦æ•¸èˆ‡ç°¡å–®ä»£æ•¸æ··åˆé¡Œ ========== */

    /* å•Ÿå‹•æ•¸å­¸éŠæˆ² */
    function startMathGame() {
        const root = document.getElementById("game-root");
        const layer = document.createElement("div");
        layer.className = "mini-game";
        layer.innerHTML = `
    <div class="mini-card">
      <div class="mini-title">âœ¨ ä¿å‘½é¡Œï¼ˆ20 é¡Œå…¨å°æ‰éï¼‰</div>
      <div class="mini-question" id="mq"></div>
      <div class="mini-options" id="mo"></div>
      <div class="mini-progress" id="mp"></div>
    </div>`;
        root.appendChild(layer);

        let correct = 0;
        renderQ();

        /** æ¸²æŸ“é¡Œç›® */
        function renderQ() {
            const { q, ans, options } = genAlgebraQ();
            document.getElementById("mq").textContent = q;
            const mo = document.getElementById("mo");
            mo.innerHTML = "";

            options.forEach((opt, i) => {
                const b = document.createElement("button");
                b.className = "mini-btn";
                b.textContent = `${"ABCD"[i]}. ${opt}`;
                b.onclick = () => {
                    if (opt === ans) {
                        correct++;
                        if (correct >= 20) {
                            root.removeChild(layer);
                            state.scene = "lunch1"; // å®Œæˆå¾Œå›åˆ°åŠ‡æƒ…
                            resetUI();
                            renderScene();
                            return;
                        }
                        document.getElementById("mp").textContent = `æ­£ç¢ºï¼é‚„å·® ${20 - correct} é¡Œ`;
                        renderQ();
                    } else {
                        root.removeChild(layer);
                        state.deaths++;
                        scenes.death.text = "äºæœç‰¹è‰²ï¼šéŒ¯ä¸€é¡Œ = å›å®¶èººå¹³ã€‚ğŸª¦ã€ç®—éŒ¯ä¸€é¡Œï¼Œäººç”Ÿ Game Overã€‘";
                        state.scene = "death";
                        resetUI();
                        renderScene();
                    }
                };
                mo.appendChild(b);
            });
            document.getElementById("mp").textContent = `ç›®å‰é€£å°ï¼š${correct} / 20`;
        }
    }

    /* ===== é¡Œå‹éš¨æ©Ÿé¸æ“‡ ===== */
    function genAlgebraQ() {
        const types = ["arithmetic", "sqrt", "algebra1", "algebra2", "sqrtXY"];
        const pick = types[rand(0, types.length - 1)];

        if (pick === "arithmetic") {
            return genRealQ(); // å››å‰‡é‹ç®—
        } else if (pick === "sqrt") {
            return genSqrtQ(); // å–®ç´”æ ¹è™Ÿé¡Œ
        } else if (pick === "algebra1") {
            return genSolveForX(); // å–®è®Šæ•¸
        } else if (pick === "algebra2") {
            return genSolveForXY(); // æ™®é€šé›™è®Šæ•¸
        } else {
            return genSqrtXYQ(); // **æ ¹è™Ÿ+äºŒå…ƒä¸€æ¬¡æ··åˆé¡Œ**
        }
    }

    /* ===== 1. åŸºæœ¬å¯¦æ•¸é¡Œ ===== */
    function genRealQ() {
        const ops = ["+", "-", "Ã—", "Ã·"];
        const op = ops[rand(0, ops.length - 1)];

        let a = rand(2, 20);
        let b = rand(2, 20);
        let ans = 0;

        if (op === "+") {
            ans = a + b;
        } else if (op === "-") {
            if (b > a) [a, b] = [b, a];
            ans = a - b;
        } else if (op === "Ã—") {
            ans = a * b;
        } else if (op === "Ã·") {
            // ä¿è­‰æ•´é™¤
            b = rand(2, 9);
            ans = rand(2, 12);
            a = ans * b;
        }

        const q = `${a} ${op} ${b} = ?`;

        // å¹²æ“¾é¸é …
        const wrongOptions = [];
        while (wrongOptions.length < 3) {
            let w = ans + rand(-3, 3);
            if (w !== ans && w >= 0 && !wrongOptions.includes(w)) {
                wrongOptions.push(w);
            }
        }

        const options = shuffle([ans, ...wrongOptions]).slice(0, 4);
        return { q, ans, options };
    }

    /* ===== 2. å–®è®Šæ•¸æ–¹ç¨‹é¡Œ ===== */
    function genSolveForX() {
        // éš¨æ©Ÿç”Ÿæˆï¼šax + b = c
        const a = rand(1, 9);
        const x = rand(1, 12);
        const b = rand(0, 10);
        const c = a * x + b;

        const q = `${a}x + ${b} = ${c}ï¼Œæ±‚ x`;

        const wrongOptions = [];
        while (wrongOptions.length < 3) {
            let w = x + rand(-3, 3);
            if (w !== x && w >= -10 && !wrongOptions.includes(w)) {
                wrongOptions.push(w);
            }
        }

        const options = shuffle([x, ...wrongOptions]);
        return { q, ans: x, options };
    }

    /* ===== 3. å…©è®Šæ•¸ç°¡å–®ä»£å…¥ ===== */
    function genSolveForXY() {
        // å…ˆéš¨æ©Ÿå‡º x å’Œ y çš„çœŸå€¼
        const x = rand(1, 9);
        const y = rand(1, 9);

        // é¡Œç›®å½¢å¼ï¼šc1 x + c2 y
        const c1 = rand(1, 5);
        const c2 = rand(1, 5);
        const result = c1 * x + c2 * y;

        const q = `è‹¥ x=${x} ä¸” y=${y}ï¼Œæ±‚ ${c1}x + ${c2}y`;

        const wrongOptions = [];
        while (wrongOptions.length < 3) {
            let w = result + rand(-5, 5);
            if (w !== result && !wrongOptions.includes(w) && w >= 0) {
                wrongOptions.push(w);
            }
        }

        const options = shuffle([result, ...wrongOptions]);
        return { q, ans: result, options };
    }

    /* ===== 4. æ ¹è™Ÿ + äºŒå…ƒä¸€æ¬¡æ··åˆé¡Œ ===== */
    function genSqrtXYQ() {
        // å…ˆç¢ºå®š x, y çš„å€¼
        const x = rand(1, 6);
        const y = rand(1, 6);

        // ç”Ÿæˆä¸€å€‹å®Œå…¨å¹³æ–¹æ•¸ï¼Œç¢ºä¿ sqrt æ˜¯æ•´æ•¸
        const perfectSquares = [4, 9, 16, 25, 36, 49, 64, 81, 100];
        const sqrtPart = perfectSquares[rand(0, perfectSquares.length - 1)];

        // ç”Ÿæˆå…©å€‹ä¿‚æ•¸
        const c1 = rand(1, 4);
        const c2 = rand(1, 4);

        // æ­£ç¢ºç­”æ¡ˆ
        const result = Math.sqrt(sqrtPart) + (c1 * x) + (c2 * y);

        // é¡Œç›®æ–‡å­—
        const q = `è‹¥ x=${x} ä¸” y=${y}ï¼Œæ±‚ âˆš${sqrtPart} + ${c1}x + ${c2}y`;

        // å¹²æ“¾é¸é …
        const wrongOptions = [];
        while (wrongOptions.length < 3) {
            let w = result + rand(-5, 5);
            if (w !== result && w >= 0 && !wrongOptions.includes(w)) {
                wrongOptions.push(w);
            }
        }

        const options = shuffle([result, ...wrongOptions]).slice(0, 4);
        return { q, ans: result, options };
    }


    /* ========== å°éŠæˆ²ï¼šè‹±æ–‡å¡«ç©º ========== */
    function startEnglishGame() {
        const root = document.getElementById("game-root");
        const layer = document.createElement("div");
        layer.className = "mini-game";
        layer.innerHTML = `
    <div class="mini-card">
      <div class="mini-title">ğŸ“ è‹±æ–‡å¡«ç©ºï¼ˆéŒ¯ä¸€é¡Œ Game Overï¼‰</div>
      <div class="mini-question" id="eq"></div>
      <div class="mini-options" id="eo"></div>
      <div class="mini-progress" id="ep"></div>
    </div>`;
        root.appendChild(layer);

        const qs = [
            { q: "Never gonna ____ you up", a: "give", options: ["give", "take", "love", "play"] },
            { q: "Super idol çš„ç¬‘å®¹ éƒ½æ²’ä½ çš„ ____", a: "ç”œ", options: ["ç”œ", "é¹¹", "é…¸", "è‹¦"] },
            { q: "Join the Hell ____", a: "divers", options: ["divers", "drivers", "lovers", "diners"] },
            { q: "I wanna be the very ____", a: "best", options: ["best", "worst", "famous", "richest"] },
            { q: "Oppa Gangnam ____", a: "Style", options: ["Style", "Smile", "Song", "Dance"] },
            { q: "Happy ever ____", a: "after", options: ["after", "long", "here", "ending"] }
        ];

        let i = 0;
        render();

        function render() {
            const cur = qs[i];
            document.getElementById("eq").textContent = cur.q;
            const eo = document.getElementById("eo");
            eo.innerHTML = "";

            cur.options.forEach(opt => {
                const b = document.createElement("button");
                b.className = "mini-btn";
                b.textContent = opt;
                b.onclick = () => {
                    if (opt === cur.a) {
                        i++;
                        if (i >= qs.length) {
                            root.removeChild(layer);
                            state.scene = "home1";
                            resetUI();
                            renderScene();
                            return;
                        }
                        render();
                    } else {
                        root.removeChild(layer);
                        state.deaths++;
                        scenes.death.text = "ğŸª¦ã€è‹±èªæ²’èƒŒå¥½ï¼Œç¤¾æœƒæå‰çˆ†ç ´ã€‘";
                        state.scene = "death";
                        resetUI();
                        renderScene();
                    }
                };
                eo.appendChild(b);
            });
            document.getElementById("ep").textContent = `ç¬¬ ${i + 1} / ${qs.length} é¡Œ`;
        }
    }

    /* ========== å°éŠæˆ²ï¼šçŒœæ‹³ ========== */
    function startRpsGame() {
        const root = document.getElementById("game-root");
        const layer = document.createElement("div");
        layer.className = "mini-game";
        layer.innerHTML = `
    <div class="mini-card">
      <div class="mini-title">âœŠâœ‹âœŒï¸ çŒœæ‹³éŠæˆ²ï¼ˆè´å…©æ¬¡æ‰ç®—éï¼Œè¼¸ä¸€æ¬¡ GameÂ Overï¼‰</div>
      <div class="mini-question" id="rps-result">é¸æ“‡ä½ çš„å‡ºæ‹³ï¼š</div>
      <div class="mini-options" id="rps-options"></div>
      <div class="mini-progress" id="rps-progress"></div>
    </div>`;
        root.appendChild(layer);

        const rpsOptions = ["å‰ªåˆ€", "çŸ³é ­", "å¸ƒ"];
        let wins = 0;
        const optsEl = document.getElementById("rps-options");
        optsEl.innerHTML = "";
        rpsOptions.forEach(opt => {
            const b = document.createElement("button");
            b.className = "mini-btn";
            b.textContent = opt;
            b.onclick = () => play(opt);
            optsEl.appendChild(b);
        });
        document.getElementById("rps-progress").textContent = "éœ€è´ 2 æ¬¡æ‰èƒ½é€šé";

        function play(userChoice) {
            const cpuChoice = rpsOptions[rand(0, 2)];
            const resultEl = document.getElementById("rps-result");
            const progressEl = document.getElementById("rps-progress");
            const winMap = { "å‰ªåˆ€": "å¸ƒ", "å¸ƒ": "çŸ³é ­", "çŸ³é ­": "å‰ªåˆ€" };
            if (userChoice === cpuChoice) {
                resultEl.textContent = `å¹³æ‰‹ï¼ä½ å‡º ${userChoice}ï¼Œå°æ–¹å‡º ${cpuChoice}`;
                progressEl.textContent = `å·²è´ ${wins} æ¬¡ï¼Œéœ€è´ 2 æ¬¡`;
                return;
            }
            if (winMap[userChoice] === cpuChoice) {
                wins++;
                resultEl.textContent = `ä½ è´äº†ï¼ä½ å‡º ${userChoice}ï¼Œå°æ–¹å‡º ${cpuChoice}`;
                if (wins >= 2) {
                    root.removeChild(layer);
                    state.scene = "ending";
                    resetUI();
                    renderScene();
                    return;
                }
                progressEl.textContent = `å·²è´ ${wins} æ¬¡ï¼Œéœ€è´ 2 æ¬¡`;
            } else {
                resultEl.textContent = `ä½ è¼¸äº†ï¼ä½ å‡º ${userChoice}ï¼Œå°æ–¹å‡º ${cpuChoice}`;
                root.removeChild(layer);
                state.deaths++;
                scenes.death.text = "çŒœæ‹³å¤±æ•—ï¼ŒçœŸæ˜¯æ‰‹æ®˜ã€‚ğŸª¦ã€ç©ä¸èµ·çŒœæ‹³ï¼Œäººç”Ÿä¹Ÿç©ä¸èµ·ã€‘";
                state.scene = "death";
                resetUI();
                renderScene();
            }
        }
    }

    renderScene();
</script>
</body>
</html>